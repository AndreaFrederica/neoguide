# 关系管理

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

关系管理功能用于管理角色之间的关系数据。

## 功能说明

### 全局关系表

小说助手维护一个全局关系表，用于：
- 存储所有解析的关系数据
- 提供查询和统计
- 支持导入导出

### 支持的文件格式

关系数据可以存储在以下格式中：
- `.json5` - JSON5 格式（推荐）
- `.rjson5` - 关系 JSON5 格式
- `.json` - 标准 JSON 格式

## 使用方法

### 命令：显示全局关系表

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 显示全局关系表`
3. 查看关系统计和列表

显示内容：
- 统计信息
- 按类型分布
- 详细关系列表

### 命令：解析当前文件的关系

从当前打开的文件解析关系：

1. 打开关系数据文件（.json5, .rjson5, .json）
2. 按 `Ctrl+Shift+P` 打开命令面板
3. 输入 `Andrea Novel Helper: 解析当前文件关系`
4. 关系会被添加到全局关系表

### 命令：清空全局关系表

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 清空全局关系表`
3. 确认清空操作

> ⚠️ **警告**：此操作不可撤销！

### 命令：导出关系数据

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 导出关系数据`
3. 选择保存位置
4. 数据导出为 JSON 文件

### 命令：导入关系数据

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 导入关系数据`
3. 选择 JSON 文件
4. 数据导入到全局关系表

### 命令：按角色查询关系

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 按角色查询关系`
3. 输入角色名称
4. 查看该角色的所有关系

## 关系数据格式

### JSON5 格式示例

```json5
{
  relationships: [
    {
      source: "张三",
      target: "李四",
      type: "friend",
      literalValue: "朋友"
    },
    {
      source: "张三",
      target: "王五",
      type: "enemy",
      literalValue: "敌人"
    }
  ]
}
```

### 字段说明

| 字段 | 说明 | 必填 |
|------|------|------|
| `source` | 源角色名称 | 是 |
| `target` | 目标角色名称 | 是 |
| `type` | 关系类型 | 是 |
| `literalValue` | 关系的字面描述 | 是 |

### 关系类型

常见的关系类型：
- `friend` - 朋友
- `enemy` - 敌人
- `family` - 家人
- `colleague` - 同事
- `lover` - 恋人
- `mentor` - 导师
- `student` - 学生

可以自定义关系类型。

## 统计信息

### 全局统计

- 总关系数
- 涉及的角色数
- 按类型分布

### 查询结果

查询角色时会显示：
- 该角色的关系数量
- 每个关系的详细信息

## 关系表显示

### 格式

关系表以 Markdown 表格格式显示：

```markdown
| 序号 | 来源角色 | 目标角色 | 字面值 | 类型 |
|------|----------|----------|--------|------|
| 1    | 张三     | 李四     | 朋友   | friend |
| 2    | 张三     | 王五     | 敌人   | enemy |
```

## 导入导出

### 导出格式

导出的 JSON 文件格式：

```json
{
  "relationships": [
    {
      "source": "张三",
      "target": "李四",
      "type": "friend",
      "literalValue": "朋友"
    }
  ]
}
```

### 导入验证

导入时会验证：
- JSON 格式是否正确
- 必填字段是否存在
- 数据结构是否有效

## 常见问题

### 解析文件失败？

1. 检查文件格式（.json5, .rjson5, .json）
2. 验证 JSON 语法
3. 确认必填字段存在

### 关系表为空？

1. 先解析一些关系数据文件
2. 或导入之前导出的数据

### 如何编辑关系？

1. 编辑关系数据文件
2. 重新解析文件
3. 关系会自动更新

### 查询不到角色？

1. 确认角色名称正确
2. 检查是否已解析相关文件
3. 查看全局关系表确认数据存在

## 相关功能

- [角色管理](../sidebar/roles.md) - 管理角色数据
- [关系图编辑器](../views/relationship-editor.md) - 可视化编辑关系
