# 格式化

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

格式化功能可以一键美化文档，确保段落格式统一。

## 功能说明

### 自动格式化会：

1. **规范化段落间空行**
   - 确保段落间有固定数量的空行
   - 移除多余的空行

2. **添加段首缩进**
   - 为段落开头添加缩进
   - 移除已有的不一致缩进

3. **移除行尾空格**
   - 清理每行末尾的空格和 Tab

4. **保护 Markdown 结构**
   - 不修改标题、列表、代码块等结构

## 使用方法

### 方法一：命令面板

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 格式化文档`
3. 执行命令

### 方法二：快捷键（如果已设置）

可以在 VS Code 快捷键设置中为 `andrea.formatDocument` 设置快捷键。

## 格式化规则

### 段落识别

段落定义为：
- 非空行
- 前一行是空行或文件开头

### 跳过的结构

以下结构不会被添加段首缩进：
- 标题 (`#`, `##`, 等)
- 引用 (`>`)
- 列表 (`-`, `*`, `+`, `1.`)
- 代码栅栏 (`` ` ``)
- 表格 (`|`)

### 缩进单位

段首缩进使用以下优先级：
1. 扩展设置 `firstLineIndentSpaces`
2. 编辑器 Tab Size 设置

示例：
```
2 个空格缩进: "  文字"
4 个空格缩进: "    文字"
Tab 缩进: "\t文字"
```

## 设置选项

在 VS Code 设置中搜索 `andrea.typeset`：

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| `blankLinesBetweenParas` | 段落间空行数 | `1` |
| `trimTrailingSpaces` | 移除行尾空格 | `true` |
| `firstLineIndentSpaces` | 段首缩进空格数 | 编辑器设置 |

### 配置示例

```json
{
  "andrea.typeset.blankLinesBetweenParas": 1,
  "andrea.typeset.trimTrailingSpaces": true,
  "andrea.typeset.firstLineIndentSpaces": 2
}
```

## 格式化效果

### 格式化前

```
第一章

这是第一段。
第二行。


这是第二段。


# 标题不会缩进
- 列表项也不会缩进
```

### 格式化后（假设 2 空格缩进，1 空行）

```
第一章

  这是第一段。
  第二行。

  这是第二段。

# 标题不会缩进
- 列表项也不会缩进
```

## 适用语言

格式化仅在以下语言中生效：
- Markdown
- Plain Text

## 高级功能

### 仅添加空行

还有一个专门的命令 `andrea.formatDocument.addBlanks`，功能类似：
- 确保段落间有空行
- 不移除已有的空行
- 应用段首缩进

## 注意事项

### 代码块

格式化会保留代码块内部的内容不变：
- 不添加缩进
- 不移除空格
- 保持原样

### 特殊格式

如果你的文档有特殊格式需求：
- 考虑使用代码块保护
- 或调整格式化设置

### 撤销

格式化后如果不满意：
- 按 `Ctrl+Z` 撤销
- 可以重新格式化

## 常见问题

### 格式化后格式不对？

1. 检查设置中的空行数量
2. 检查缩进设置
3. 确认是否被识别为段落

### 某些行被缩进了？

这是正常的，如果：
- 该行是段落开头
- 不是 Markdown 结构
- 不是代码块

### 如何禁用段首缩进？

设置 `firstLineIndentSpaces` 为 `0` 或空字符串。

### 如何保留行尾空格？

设置 `trimTrailingSpaces` 为 `false`。

## 相关功能

- [智能回车](./smart-enter.md) - 输入时保持格式
- [自动配对](./auto-pairs.md) - 符号配对
- [基础工作流程](../getting-started/basic-workflow.md) - 写作流程
