# 错别字检测

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

错别字检测功能帮助你发现文档中的错误拼写。支持规则识别和大语言模型识别两种模式。

## 功能概述

### 检测方式

| 方式 | 说明 | 特点 |
|------|------|------|
| **规则识别 (macro)** | 使用 `/correct` 规则进行识别 | 无需网络、快速、可定制 |
| **大语言模型 (llm)** | 使用 LLM 进行智能识别 | 更准确、需网络、注意数据安全 |

## 打开方式

### 方法一：快速设置

1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 `Andrea Novel Helper: 错别字识别快速设置`
3. 配置各种选项

### 方法二：VS Code 设置

搜索 `AndreaNovelHelper.typo`

## 快速设置选项

### 基本设置

| 选项 | 说明 | 默认值 |
|------|------|--------|
| 启用错别字识别 | 开启/关闭错别字检测功能 | 禁用 |
| 打开文档自动识别 | 打开文档时自动进行检测 | 启用 |
| 变更自动识别 | 内容变更时自动触发扫描 | 启用 |
| 手动扫描当前文档 | 在手动模式下触发扫描 | - |
| 手动重新扫描（清理缓存） | 清理缓存后执行完整扫描 | - |

### 识别模式

#### 规则识别 (macro)

使用 `/correct` 规则进行错别字识别：

- 无需网络连接
- 响应速度快
- 可自定义规则
- 适合常用错别字

#### 大语言模型识别 (llm)

使用大语言模型进行智能识别：

- **警告**：需注意数据安全！文档内容会发送到 LLM API
- 更准确的识别
- 支持上下文理解
- 需要配置 API

### 变更时间窗口（请求延迟）

| 选项 | 说明 | 默认值 |
|------|------|--------|
| 启用变更时间窗口 | 启用请求延迟，避免频繁请求 | 禁用 |
| 请求延迟窗口时长 | 设置延迟时间（毫秒） | 1000 ms |

**可选时长**：400, 700, 1000, 1500, 2000, 3000 ms 或自定义（100-10000）

此功能可以避免在输入过程中频繁发送识别请求，只在停止输入一段时间后才触发扫描。

### 客户端直连大模型

#### 配置选项

| 选项 | 说明 | 默认值 |
|------|------|--------|
| 启用客户端直连大模型 | 开启 LLM 识别模式 | 禁用 |
| API Base | LLM API 地址 | `https://api.deepseek.com/v1` |
| API Key | API 密钥 | 需配置 |
| 模型名称 | 使用的模型 | `deepseek-v3` |
| Temperature | 温度参数（0-2） | `0` |

#### 配置步骤

1. 在快速设置中选择"客户端直连大模型"
2. 配置 API Base、API Key、模型名称
3. 在识别模式中选择"llm"
4. 启用错别字识别

> ⚠️ **重要提示**：使用 LLM 模式时，文档内容会发送到第三方 API，请注意数据安全！

### 数据持久化

| 选项 | 说明 | 默认值 |
|------|------|--------|
| 启用数据持久化 | 将识别结果保存到本地文件 | 禁用 |
| 自动清理过期数据 | 自动删除过期的数据文件 | 启用 |
| 配置数据保存天数 | 设置数据保留天数（1-365） | 30 天 |
| 清理所有持久化数据 | 手动删除所有已保存的数据文件 | - |

持久化数据保存在 `novel-helper/typo/` 目录下。

### 调试设置

| 选项 | 说明 | 默认值 |
|------|------|--------|
| LLM 调试输出 | 输出客户端 LLM 请求与响应 | 禁用 |
| 服务端调试输出 | 输出服务端 HTTP 请求/响应概要 | 禁用 |
| 压缩调试输出 | 调试输出压缩为单行 | 禁用 |

## 检测结果

### 错别字标记

检测到的错别字会：
- 在文档中标记
- 显示建议的正确写法
- 提供一键替换

### 结果显示

- 在文档中以特殊样式显示
- 悬停显示详细信息
- 可查看原始文本和建议修正

## 使用方法

### 自动识别

启用后，识别会在以下情况触发：
- 打开文档时（如果启用"打开文档自动识别"）
- 编辑文档时（如果启用"变更自动识别"）
- 停止输入后（如果启用"变更时间窗口"）

### 手动识别

如果禁用了自动识别，可以使用以下命令：
- `Andrea Novel Helper: 错别字扫描当前文档`
- `Andrea Novel Helper: 错别字重新扫描文档（清理缓存）`

### 查看修正建议

1. 找到标记的错别字
2. 查看建议的修正
3. 选择应用修正

## 敏感词修复

集成在角色管理中：

1. 在角色管理中定义敏感词
2. 添加 `fixes` 字段（修正建议）
3. 自动补全会显示修正建议
4. 可以快速替换

### 示例配置

```yaml
name: 作孽
type: 敏感词
description: 错别字
fixes:
  - 昨夜
  - 昨天晚上
```

## 常见问题

### 没有检测到错别字？

1. 确认已启用错别字识别
2. 检查识别模式设置（macro/llm）
3. LLM 模式需检查网络连接和 API 配置
4. 尝试手动触发扫描

### LLM 模式不工作？

1. 检查 API Base 和 API Key 是否正确配置
2. 确认识别模式设置为"llm"
3. 查看调试输出了解错误信息
4. 注意数据安全风险

### 如何提高检测准确性？

1. 规则模式：自定义 `/correct` 规则
2. LLM 模式：选择合适的模型和参数
3. 结合使用敏感词修复功能
4. 人工复核识别结果

### 检测速度慢？

1. 调整"变更时间窗口"设置
2. 禁用"变更自动识别"，改用手动模式
3. 规则模式比 LLM 模式更快

## 数据安全

### LLM 模式注意事项

使用 LLM 模式时：
- **文档内容会发送到第三方 API**
- 请确保符合你的数据安全要求
- 建议使用私有部署的模型
- 敏感内容请谨慎使用

### 数据持久化

持久化数据保存在本地：
- `novel-helper/typo/` 目录
- 包含识别结果和缓存
- 可以随时清理

## 相关命令

| 命令 | 说明 |
|------|------|
| `andrea.typo.quickSettings` | 打开快速设置面板 |
| `andrea.typo.toggle` | 启用/禁用错别字识别 |
| `andrea.typo.toggleAutoIdentifyOnOpen` | 启用/禁用打开文档自动识别 |
| `andrea.typo.toggleAutoScanOnChange` | 启用/禁用变更自动识别 |
| `andrea.typo.toggleDelay` | 启用/禁用变更时间窗口 |
| `andrea.typo.changeDelayWindow` | 配置请求延迟窗口时长 |
| `andrea.typo.changeMode` | 切换识别模式 (macro/llm) |
| `andrea.typo.configureClientLLM` | 配置客户端直连大模型 |
| `andrea.typo.configurePersistence` | 配置数据持久化 |
| `andrea.typo.configureDebug` | 配置调试设置 |
| `andrea.typo.scanDocument` | 手动扫描当前文档 |
| `andrea.typo.rescanDocument` | 手动重新扫描（清理缓存） |

## 相关功能

- [自动补全](./completions.md) - 显示修正建议
- [角色管理](../sidebar/roles.md) - 管理敏感词
- [格式化](./formatting.md) - 文档格式化
