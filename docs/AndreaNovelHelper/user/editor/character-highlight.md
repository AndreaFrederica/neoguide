# 角色悬停提示

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

角色悬停提示功能让你在写作时快速查看角色的详细信息。

## 功能说明

### 悬停显示

鼠标悬停在角色名称上时，会显示角色的详细信息：

```
┌─────────────────────────────┐
│ 张三                        │
│                             │
│ 描述: 主角，勇敢的冒险家     │
│                             │
│ 类型: 主角                  │
│ 从属: 冒险小队              │
│ 别名: 小张, 阿三            │
│                             │
│ 颜色: ■ #FF0000             │
└─────────────────────────────┘
```

## 显示的信息

### 基本信息

- **名称**：角色主名称
- **描述**：角色详细描述
- **类型**：主角、配角、联动角色等
- **从属**：所属组织或阵营
- **颜色**：角色标签颜色

### 扩展信息

如果角色有额外信息，也会显示：
- **别名**：其他称呼
- **修复**：敏感词替换建议
- **包路径**：角色所属包
- **源文件**：定义角色的文件
- **自定义字段**：其他扩展信息

## 工作原理

### 模式匹配

小说助手使用 **Aho-Corasick 算法**进行高效匹配：
- 同时搜索所有角色名称
- 性能优异，不影响编辑体验
- 支持大量角色

### 匹配范围

匹配包括：
- 角色主名称
- 角色别名
- 修复候选（敏感词）

### 文档支持

悬停提示在以下文档中可用：
- Markdown 文件
- 纯文本文件
- 虚拟大纲文件 (`andrea-outline://`)

## 使用方法

### 查看角色信息

1. 在文档中输入角色名称
2. 鼠标悬停在名称上
3. 查看弹出的详细信息

### 自动更新

角色信息会自动更新：
- 打开文档时
- 编辑文档时
- 角色数据变化时

### 大文件保护

超过阈值的文件会跳过扫描（默认 50KB），避免性能问题。

## 设置选项

在 VS Code 设置中搜索 `AndreaNovelHelper`：

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| `hugeFile.thresholdBytes` | 大文件阈值（字节） | `51200` |

### 大文件阈值

如果文件超过阈值：
- 不进行角色匹配
- 避免性能问题
- 可以手动调整阈值

## 颜色显示

### 颜色来源

角色颜色按优先级：
1. 角色定义的 `color` 字段
2. 角色类型对应的默认颜色
3. 全局默认颜色设置

### 颜色用途

颜色用于：
- 悬停提示中的颜色块
- 其他视图中的角色标签
- 帮助快速识别角色

## 性能说明

### 增量刷新

小说助手使用增量刷新：
- 只更新可见的编辑器
- 只扫描受支持的语言
- 避免不必要的计算

### 异步匹配

角色匹配在后台进行：
- 不阻塞编辑
- 版本检查避免过时结果
- 失败时自动回退

## 常见问题

### 悬停没有显示？

1. 确认角色名称正确
2. 检查文档是否受支持
3. 确认不是大文件
4. 等待片刻让匹配完成

### 显示的信息不完整？

检查角色定义是否完整：
- 确认角色在角色管理中存在
- 检查是否有描述等信息
- 尝试刷新角色数据

### 大文件没有悬停提示？

这是正常的保护机制：
- 避免性能问题
- 可以调整阈值设置
- 或将文件拆分

### 如何禁用悬停提示？

目前没有单独的开关，但可以通过：
- 修改大文件阈值为较小值
- 或禁用整个扩展

## 相关功能

- [角色管理](../sidebar/roles.md) - 管理角色数据
- [自动补全](./completions.md) - 快速输入角色名
- [关系图编辑器](../views/relationship-editor.md) - 可视化角色关系
