# 自动补全

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

自动补全功能让你快速输入角色名称，提高写作效率。

## 功能说明

### 触发补全

在文档中输入时，会自动显示角色名称列表：
- 包含角色主名称
- 包含角色别名
- 包含敏感词修正建议

### 补全内容

每个补全项显示：
- **名称**：角色名称或别名
- **类型**：角色类型（主角、配角等）
- **描述**：角色描述的第一行
- **从属**：所属组织或阵营

详细信息在悬停时显示：
- 完整描述
- 所有别名
- 颜色标识
- 扩展字段

## 触发模式

### 可用模式

在设置中配置 `AndreaNovelHelper.completion.triggerMode`：

| 模式 | 说明 |
|------|------|
| `loose` | 宽松模式，包含匹配即可触发 |
| `startsWith` | 前缀匹配，必须开头匹配 |
| `symbolLoose` | 符号+宽松模式 |
| `symbolStartsWith` | 符号+前缀匹配 |

### 符号模式

使用符号模式时，需要先输入触发符号（默认 `@`）：

```
@张  → 显示所有包含"张"的角色
```

可以在设置中配置 `completion.symbolPrefixes` 来自定义符号。

## 使用方法

### 触发补全

1. 开始输入角色名称
2. 自动弹出补全列表
3. 继续输入缩小范围
4. 选择要插入的角色

### 选择补全

- **鼠标**：点击选择
- **键盘**：↑↓ 选择，Enter 确认
- **Tab**：选择第一个建议

### 查看详情

- 悬停在补全项上查看详细信息
- 包括描述、颜色、扩展字段等

## 补全排序

### 排序规则

补全项按以下优先级排序：
1. 开头匹配 > 包含匹配
2. 匹配度（更短的匹配优先）
3. 字母顺序（中文拼音）

### 敏感词修正

敏感词的修正建议会：
- 显示在普通角色之后
- 标记为"修复"类型
- 说明来自哪个敏感词

## 过滤规则

### 自动过滤

以下内容不会出现在补全中：
- 类型为"敏感词"的角色
- 敏感词的名称和别名
- 只有修正建议会显示

### 最小字符数

默认需要输入至少 1 个字符才会触发。

可以在设置中配置 `AndreaNovelHelper.minChars`。

## 设置选项

在 VS Code 设置中搜索 `AndreaNovelHelper`：

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| `completion.triggerMode` | 触发模式 | `loose` |
| `completion.symbolPrefixes` | 符号前缀列表 | `["@"]` |
| `minChars` | 最小字符数 | `1` |
| `defaultColor` | 默认颜色 | `#A0A0A0` |

### 配置示例

```json
{
  "AndreaNovelHelper.completion.triggerMode": "symbolLoose",
  "AndreaNovelHelper.completion.symbolPrefixes": ["@", "＠"],
  "AndreaNovelHelper.minChars": 2
}
```

## 显示格式

### 详情显示

补全的详细信息支持：
- Markdown 格式
- 列表转换
- 智能换行
- 代码块保留

### 颜色显示

使用内联 SVG 显示颜色：
- 跨主题兼容
- 清晰可见
- 与悬停提示一致

## 性能说明

### 高性能

自动补全经过优化：
- 本地缓存
- 快速过滤
- 延迟加载

### 调试

如果遇到问题，可以启用调试日志：
- 设置 `debug.completionLog` 为 `true`
- 在输出面板查看日志

## 常见问题

### 补全没有出现？

1. 检查是否输入了足够的字符
2. 确认触发模式设置
3. 尝试使用符号模式
4. 查看调试日志

### 敏感词也显示了？

这是正常的，但只显示：
- 修正建议
- 不显示敏感词名称
- 标记为"修复"类型

### 如何禁用补全？

在 VS Code 设置中：
- 禁用扩展的补全提供器
- 或调整触发模式

### 补全速度慢？

1. 减少角色数量
2. 使用符号模式减少匹配
3. 增加最小字符数

## 相关功能

- [角色悬停提示](./character-highlight.md) - 查看角色详情
- [角色管理](../sidebar/roles.md) - 管理角色数据
- [敏感词检测](./typo-detection.md) - 错别字检测
