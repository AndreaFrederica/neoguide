# 自动配对

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

自动配对功能在输入左符号时自动补全右符号，提升写作效率。

## 功能说明

### 基本配对

输入左符号时，自动补全右符号：

```
输入 (   → 自动生成 ()|
输入 "   → 自动生成 ""|
输入 「   → 自动生成 「」|
```

### 支持的配对

默认支持的符号对：

| 左符号 | 右符号 |
|--------|--------|
| `(` | `)` |
| `[` | `]` |
| `{` | `}` |
| `"` | `"` |
| `'` | `'` |
| `「` | `」` |
| `『` | `』` |

## 中文 IME 修复

### 问题描述

使用中文输入法时，普通自动配对可能导致问题：
- IME 转换被干扰
- 引号自动转换失效

### 解决方案

小说助手提供**中文 IME 修复**功能：
- 使用物理键盘模拟
- 让 IME 正常处理转换
- 自动补全配对

### 工作原理

1. 输入左引号（如 `「`）
2. 使用键盘模拟输入配对
3. IME 自动转换为右引号（如 `」`）
4. 光标定位到配对中间

### 启用要求

中文 IME 修复需要原生键盘模块 (`enigo_keyboard.node`)：
- Windows: 自动支持
- macOS/Linux: 需要额外配置

如果模块加载失败，会：
- 显示警告提示
- 回退到普通自动配对
- 不影响其他功能

## 设置选项

在 VS Code 设置中搜索 `andrea.typeset`：

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| `enableAutoPairs` | 启用自动配对 | `true` |
| `enableChineseIMEFix` | 启用中文 IME 修复 | `true` |
| `chineseIMEDelay` | 中文 IME 延迟（毫秒） | `50` |

### 自定义配对

修改 `andrea.typeset.pairs` 配置：

```json
{
  "andrea.typeset.pairs": [
    { "open": "「", "close": "」" },
    { "open": "『", "close": "』" },
    { "open": "\"", "close": "\"" }
  ]
}
```

## 使用方法

### 输入配对符号

1. 输入左符号（如 `「`）
2. 自动生成配对（`「」`）
3. 光标在中间
4. 继续输入内容

### 跳出配对

按回车键可以跳出配对（需要启用 [智能回车](./smart-enter.md)）：

```
「内容|」  → 按 Enter → 「内容」
```

## 适用语言

自动配对仅在以下语言中生效：
- Markdown
- Plain Text

## 常见问题

### 中文引号没有自动配对？

1. 检查是否启用了 `enableChineseIMEFix`
2. 确认键盘模块是否正确加载
3. 查看是否有警告提示

### 键盘模块加载失败？

如果看到警告：
- Windows: 确保安装了正确版本
- macOS/Linux: 可能需要额外依赖

功能会自动回退到普通模式，不影响使用。

### 延迟太高或太低？

调整 `andrea.typeset.chineseIMEDelay`：
- 默认: 50ms
- 如果有问题：尝试 30-100ms

### 如何禁用某个配对？

在设置中移除对应的配对配置，或设置 `enableAutoPairs` 为 `false`。

## 技术说明

### 键盘模拟

中文 IME 修复使用原生键盘模拟：
- Windows: 使用虚拟键码 (VK_OEM_7)
- 其他平台: 相应键位映射

### 延迟说明

延迟用于确保键盘模拟的稳定性：
- 太低：可能不稳定
- 太高：影响响应速度

建议使用默认值 (50ms)。

## 相关功能

- [智能回车](./smart-enter.md) - 跳出配对符号
- [格式化](./formatting.md) - 文档格式化
- [基础工作流程](../getting-started/basic-workflow.md) - 写作流程
