# 预览面板

> **⚠️ 免责声明**：本文档由 **GLM4.7** 自动生成，内容可能存在错误或不完整之处。**请以人工书写的官方文档为准**。

---

预览面板用于查看 Markdown/纯文本文件的**纯文本渲染**版本，提供完整的阅读器界面，包括字体设置、主题切换、TTS 语音朗读、分页模式等功能。

## 打开方式

### 命令面板

按 `Ctrl+Shift+P` 打开命令面板，输入 `Andrea Novel Helper: 打开预览`。

### 快捷键

可自定义快捷键绑定到 `myPreview.open` 命令。

## 界面布局

预览面板打开后显示：

```
┌─────────────────────────────────────────┐
│  [TTS 控件]                    ⚙[设置] │
│                                         │
│         纯文本渲染内容区域              │
│                                         │
│                                         │
└─────────────────────────────────────────┘
│  [◀ 1/5 ▶]  (分页模式时显示)          │
└─────────────────────────────────────────┘
```

## TTS 语音朗读控件

### 控件位置

预览面板右上角显示 TTS 控件：
- 语音选择下拉框
- 播放/暂停/停止按钮
- 状态显示

### TTS 操作

| 按钮 | 功能 |
|------|------|
| **选择语音** | 从系统可用语音中选择（中文语音优先显示） |
| **播放** | 开始朗读选中文本或全文 |
| **暂停** | 暂停朗读 |
| **停止** | 停止朗读并清除高亮 |

### 朗读高亮

- 当前朗读的文本会以金色背景高亮显示
- 自动滚动到正在朗读的位置
- TTS 自动跨页（分页模式下）

### 右键朗读

在预览面板中右键点击：
- **朗读选中文本** - 仅朗读选中的文本

## 阅读器设置

### 打开设置

点击预览面板右下角的 **⚙ 齿轮按钮** 打开设置面板。

### 设置选项

#### 外观设置

| 设置 | 说明 | 范围 |
|------|------|------|
| **字体大小** | 调整文字大小 | 12 - 30 px |
| **字体** | 选择字体 | 跟随 VS Code / 自定义 |
| **行间距** | 调整行高 | 1.2 - 2.2 |
| **段落间距** | 段落之间的间距 | 0 - 32 px |
| **页面边距** | 内容区域的内边距 | 0 - 48 px |
| **宽度** | 内容宽度（手动模式） | 320 - 1600 px |
| **高度** | 页面高度（分页手动模式） | 0 - 3000 px |

#### 模式设置

| 设置 | 选项 | 说明 |
|------|------|------|
| **显示方式** | 滚动 / 分页 | 滚动模式或分页模式 |
| **对齐** | 左对齐 / 两端 | 文本对齐方式 |
| **列数** | 1 列 / 2 列 | 多列显示（仅滚动模式） |
| **同步滚动** | 开启 / 关闭 | 编辑器与预览同步 |
| **主题模式** | 浅色 / 深色 / 跟随 | 界面主题 |
| **高度模式** | 自动 / 手动 | 分页高度计算方式 |
| **宽度模式** | 自动 / 手动 | 内容宽度计算方式 |

#### 字体模式

| 模式 | 说明 |
|------|------|
| **跟随 VS Code** | 使用编辑器配置的字体 |
| **自定义** | 从系统字体列表中选择 |

点击 **刷新** 按钮重新枚举系统字体。

### 预设管理

| 功能 | 说明 |
|------|------|
| **预设下拉框** | 选择已保存的预设 |
| **保存** | 保存当前设置为当前预设 |
| **新建** | 创建新预设 |
| **删除** | 删除当前预设 |

### 重置默认

点击 **重置默认** 按钮恢复所有设置到初始值。

## 滚动模式

### 滚动操作

| 操作 | 说明 |
|------|------|
| **鼠标滚轮** | 上下滚动 |
| **拖动滚动条** | 快速定位 |
| **空格键** | 向下翻页 |
| **Shift+空格** | 向上翻页 |

### 双向同步

| 方向 | 触发条件 |
|------|----------|
| 编辑器 → 预览 | 编辑器滚动、选区变化 |
| 预览 → 编辑器 | 预览面板滚动 |

同步滚动可在设置中开启或关闭。

## 分页模式

### 分页显示

切换到分页模式后：
- 内容按固定高度分割为页面
- 底部显示分页控件：`◀ 1 / 5 ▶`
- 显示阅读进度条

### 分页操作

| 操作 | 说明 |
|------|------|
| **点击 ▶** | 下一页 |
| **点击 ◀** | 上一页 |
| **PgDn / 空格 / →** | 下一页 |
| **PgUp / ←** | 上一页 |

### 分页高度

| 模式 | 说明 |
|------|------|
| **自动** | 根据窗口高度自动计算（减去控件高度） |
| **手动** | 使用设置中指定的高度（0 = 自动） |

### TTS 自动跨页

朗读时自动翻到下一页，无需手动操作。

## 主题模式

| 主题 | 说明 |
|------|------|
| **浅色** | 白色背景，深色文字 |
| **深色** | 深色背景，浅色文字 |
| **跟随** | 跟随 VS Code 主题 |

## 复制纯文本

### 方法一：右键菜单

在预览面板中右键点击：
- **复制纯文本** - 复制选中文本或全文

### 方法二：命令

使用命令 `Andrea Novel Helper: 复制纯文本到剪贴板`：
- 有选区：复制选区的纯文本
- 无选区：复制全文的纯文本

## 导出功能

### 导出为 TXT

使用命令 `Andrea Novel Helper: 导出当前文档为纯文本`：
1. 打开要导出的文档
2. 执行命令
3. 选择保存位置
4. 文件导出为 `.txt` 格式

## 面板管理

### 主面板跟随

首次打开预览后成为"主面板"：
- 切换文件时自动切换显示
- 切换前自动停止 TTS

### 多面板支持

可同时打开多个文件的预览面板。

### 面板恢复

VS Code 重启后自动恢复：
- 主预览面板
- 滚动位置
- 文档关联

## 右键菜单

在预览面板中右键点击：

| 选项 | 功能 |
|------|------|
| **复制纯文本** | 复制选区或全文 |
| **朗读选中文本** | 仅朗读选中的文本 |

## 快捷键

### 预览面板内

| 按键 | 功能 | 模式 |
|------|------|------|
| `Space` | 向下翻页 | 分页 |
| `Shift+Space` | 向上翻页 | 分页 |
| `PageDown` | 下一页 | 分页 |
| `PageUp` | 上一页 | 分页 |
| `→` | 下一页 | 分页 |
| `←` | 上一页 | 分页 |
| `Escape` | 关闭设置面板 | 任意 |

## 配置选项

预览面板使用 VS Code 编辑器配置：

| 配置 | 说明 |
|------|------|
| `editor.fontFamily` | 预览字体（跟随模式） |
| `editor.fontSize` | 预览字号（跟随模式） |
| `editor.lineHeight` | 行高（用于视口估算） |
| `editor.padding.top/bottom` | 编辑器内边距 |

## 数据持久化

预览设置保存在浏览器 LocalStorage：
- `anhReaderSettings` - 元数据
- `anhReaderPresets` - 预设配置

面板状态通过 VS Code API 持久化：
- 文档关联
- 滚动位置
- 主面板标记

## 常见问题

### 预览面板空白？

1. 确认文件是 `.md` 或 `.txt` 格式
2. 检查文件内容是否为空
3. 尝试刷新面板

### TTS 不工作？

1. 确认系统支持 Web Speech API
2. 检查是否选择了语音
3. 尝试停止后重新播放

### 分页不正确？

1. 调整页面高度设置
2. 切换到自动高度模式
3. 调整字体大小或行间距

### 字体不生效？

1. 切换到自定义字体模式
2. 点击刷新重新枚举系统字体
3. 检查字体是否已安装

### 同步滚动不准确？

1. 检查同步滚动是否开启
2. 等待增量更新完成
3. 尝试手动滚动触发同步

## 命令列表

| 命令 ID | 说明 |
|---------|------|
| `myPreview.open` | 打开预览面板 |
| `myPreview.exportTxt` | 导出为纯文本 |
| `myPreview.ttsPlay` | TTS 播放 |
| `myPreview.ttsPause` | TTS 暂停 |
| `myPreview.ttsStop` | TTS 停止 |
| `myPreview.copyPlainText` | 复制纯文本 |

## 相关功能

- [批注管理](../sidebar/comments.md) - 批注面板
- [写作时间统计](./time-stats.md) - 时间统计面板
- [编辑器功能](../editor/) - 编辑器相关功能
