# 版本更新日志

> Andrea Novel Helper 的完整版本更新记录

## 最新版本

### [0.4.53] - 2025-12-29

#### 🐛 修复
- 默认关闭了中文IME修复，其可能在某些操作系统和输入法下无法正常工作，导致输入异常。如果需要使用该功能，请手动开启 `andrea.typeset.enableChineseIMEFix` 配置项。

#### ✨ 新增
- 增加自动滚动功能，支持编辑时自动滚动到某个比例位置，新增配置项 `andrea.autoScroll.toggle` 用于开启或关闭自动滚动功能，`andrea.autoScroll.setRatio` 用于设置自动滚动的比例位置（0-1之间的小数），`andrea.autoScroll.scrollToEnd` 用于快速滚动到文档末尾。
- 支持了同uuid角色的定义分散在多个文件里的情况，现在会合并这些定义，并且可用设定优先级。
- 增强了角色Treeview视图对于嵌套属性的显示支持，现在可以展开查看角色的嵌套属性。
- 新增了角色的Style属性，允许用户设置角色的背景色，粗体，斜体等样式，增强角色的可视化效果。
- 增强了md2Plaintext的转换功能，现在支持更多的Markdown语法元素，如超链接，图片等。

---

### [0.4.47] - 2025-12-09

#### 🐛 修复
- 修复了中文IME下对中文引号补全的不良体验问题，新增配置项 `andrea.typeset.enableChineseIMEFix` （默认开启）和 `andrea.typeset.chineseIMEDelay` （默认50ms），通过模拟键盘输入的方式来改善中文输入法下的引号补全体验，避免输入法状态导致的下一次输入错误。

---

### [0.4.45] - 2025-12-04

#### ✨ 新增
- 新增 TypstMemoryProvider 用于内存文件系统操作,通过 andrea-typst:// 协议实现对生成的 Typst 文档的实时访问，同时支持通过设置选中一个真实临时路径 来实现Typst插件的实时预览功能
- 引入 TypstPreviewStatusBar 管理状态栏中的预览状态,允许用户切换和管理 Typst 预览
- 增强 typstExport 和 typstPreview 命令,支持模板选择和内存映射以实现实时预览
- 实现文档更改时 Typst 预览的自动更新,确保流畅的编辑体验
- 更新 Typst 模板以改进格式和结构

---

### [0.4.43] - 2025-12-01

#### 🐛 修复
- 修复了JsonDB数据库后端下，路径计算错误导致文件追踪数据被自动删除的问题

#### ✨ 新增
- 新增了文件追踪器的打开分片文件命令，允许用户直接打开当前文件对应的追踪数据分片文件进行查看和调试

---

### [0.4.41] - 2025-12-01

#### 🐛 修复
- 修复了写作统计在开启启动快照加速时的错误清除数据库问题
- 修复了脚本运行时的mcp显示和调用问题

---

### [0.4.39] - 2025-11-26

#### ✨ 新增
- 新增了基于Faker-js的随机姓名生成器
  - 支持多种语言和文化背景的姓名生成
  - 可配置生成规则，如性别、长度等
  - 通过命令面板或右键菜单快速生成并插入到当前文档

---

### [0.4.37] - 2025-11-25

#### ✨ 新增
- 右键添加新Role时，支持选择位置（扫描角色库文件后给出角色库内的角色文件列表供选择）
- 新增配置项 `AndreaNovelHelper.completion.segmenterType`，允许选择自动补全的分词器类型：
  - `auto`：智能选择（中文多时用jieba）
  - `intl`：强制使用Intl.Segmenter
  - `jieba`：强制使用jieba分词器（jieba对中文分词更准确，能提供更好的中文输入补全体验）

---

### [0.4.35] - 2025-11-21

#### 🐛 修复
- 修正了Typo在上个更新之后失效的问题

#### ✨ 新增
- 空Typo变更跳过机制，更加节省Token
- 新增设置允许开关自动变更扫描，关闭后后续扫描需要手动触发，节省Token
- 新增可调整的变更窗口机制，允许抑制连续编辑时的Typo扫描，节省Token

---

### [0.4.33] - 2025-11-20

#### ✨ 新增
- 新增配置项 `AndreaNovelHelper.wordCount.parallelStatCheck` ，允许使用并行缓存stat校验，默认开启
- 新增了基于LLM的快速翻译工具，在编辑器选中文件后，可以快速右键翻译为一种目标语言，支持替换选区、打开到新编辑器、复制到粘贴板三种翻译目标
- 对于启动时，做了更多的优化，通过减少stat调用，提升了启动速度

---

### [0.4.31] - 2025-11-19

#### 🐛 修复
- 修复字数统计视图在某些情况下未正确更新的问题：确保在文件变更时，相关的字数统计数据能够及时刷新，避免显示过时信息。
- 修复了错误的冷启动快照处理方式和错误的目录递归预取逻辑：改进了启动快照的加载机制，确保在冷启动时正确处理文件和目录的预取，提升启动性能和数据一致性。
- 增加了选项 `AndreaNovelHelper.wordCount.skipStartupStatCheck` ，允许用户配置是否在启动时跳过字数统计检查，以提高启动速度。

---

### [0.4.27] - 2025-11-18

#### ✨ 新增
- 新增配置项 `wordCount.primaryUnit`，用于设置字数统计的单位
  - `excludePunct`：词计（CJK字数 + 英文单词）
  - `includePunct`：含标点（非空白字符）
  - `noPunct`：不含标点（非空白且排除标点）

---

### [0.4.25] - 2025-11-18

#### ✨ 新增
- 新增脚本运行侧栏和脚本系统
- 新增的脚本系统允许用户自定义脚本，并且可以在侧栏中一键运行
- 新增的脚本系统支持MCP服务器，这样允许使用MCP调用浏览器，实现自动发布章节

---

### [0.4.23] - 2025-11-18

#### ✨ 新增
- 新增配置项 `typeset.addBlanks.sentenceEnders`，用于自定义句子结束标点
- 新增配置项 `typeset.addBlanks.leadingOpeners`，用于自定义段落开始标点
- 新增配置项 `typeset.addBlanks.trailingClosers`，用于自定义段落结束标点
- 新增命令 `andrea.formatDocument.addBlanks`，用于自动补段间空行

---

### [0.4.21] - 2025-11-17

#### ✨ 新增
- 内置Typst渲染模板增加一个简单的论坛体模板
- 现在Typst渲染支持图片了，编译器会自动转换图片路径
- 现在默认build中间文件不会被自动删除，方便查看中间产物
- 现在文章右键菜单，资源管理器右键菜单都增加了导出Typst的选项

---

### [0.4.19] - 2025-11-16

#### ✨ 新增
- 字数统计状态栏显示模式：详细/半精简/精简
  - 详细：显示用时、字数与速度
  - 半精简：显示字数与当前速度
  - 精简：仅显示总字数
- 字数统计状态栏速度单位：CPM/CPH

---

### [0.4.17] - 2025-11-16

#### 🐛 修复
- Typst 模板编译在含空格/中文路径下报错：移除 Windows Shell 调用，改用原生参数传递，避免 Shell 误拆分；支持空格、中文、括号、方括号、和号 (&) 与 Emoji 等路径字符。

#### 🧪 验证
- 覆盖输入/输出/工作目录均含特殊字符的用例，分别导出 PDF/PNG/SVG，全部通过；PNG 输出生成 `输出-1.png` 序列。
- 修正测试文档中的 `#` 未转义导致的 Typst 变量错误，示例内容可编译。

#### ⚙️ 变更
- 编译日志继续展示带引号的命令预览，实际执行统一按参数数组传递；不影响性能与模板渲染。
- 这个版本之后，版本发布开始分为std和exp两个版本，std版本不会随着code自动启动，exp版本会随着code自动启动

---

### [0.4.11] - 2025-11-15

#### ✨ 新增
- Typst 文稿导出（PDF/图片），支持当前文件与资源管理器右键批量导出
- 模板系统：内置/外置并行索引；支持单文件模板；新增 `title-only` 模板
- Markdown 解析：`&Def Title/Subtitle/Category` 元字段；块级解析（标题/段落/列表/代码/引用/图片/分隔线）
- Liquid 过滤器：`md2typst`（粗体/斜体/链接）
- 语法高亮与片段：注入 `&Def` 语法；为 md/txt 添加 `&Def` 代码片段与补全

#### 🛠️ 重构
- 导出与剪贴板实现迁移至 `src/commands/*` 模块；`activate.ts` 仅保留注册逻辑
- 渲染/编译服务抽象：统一 `exportService`，完整日志（命令/stdout/stderr/退出码）

---

### [0.4.10] - 2025-10-7

#### 🐛 修复
- 修复了软禁用插件功能损坏的问题

---

### [0.4.9] - 2025-10-6

#### 🖋️ 更改
- 支持了思考过程模型的关闭思考设置

#### ✨ 新增
- 新增角色引用热力图和气泡图功能
  - 支持通过 `AndreaNovelHelper.openRoleHeatmap` 命令打开热力图面板
  - 热力图展示角色在文件中的引用频率，帮助识别高频角色

---

### [0.4.8] - 2025-10-5

#### 🖋️ 更改
- 支持了带思考过程的模型
- 优化了文件追踪器的日志输出
- 优化了文件追踪器的路径清理逻辑（AndreaNovelHelper.fileTracking.cleanAbsolutePaths）
- 新增了文件追踪器的详细日志开关（AndreaNovelHelper.fileTracker.enableVerboseLogging）

---

### [0.4.6] - 2025-10-5 预发布

#### ✨ 新增
- **🔀 时间线编辑器嵌套节点支持**：全新的层级时间线管理系统
  - 支持亲代-子节点嵌套结构，可创建包含多个子事件的章节容器
  - 时间区间支持：事件可设置开始时间和结束时间 (精确到秒)
  - 可调整亲代节点尺寸 (width/height)，创建自定义大小的容器
  - 子节点可限制在亲代节点内移动 (extent: 'parent')
  - 自动扩展亲代节点功能 (expandParent)，拖动子节点到边缘时自动扩大亲代节点
  - 时间格式为 ISO 8601 精确到秒 (YYYY-MM-DDTHH:mm:ss)
  - 节点显示智能格式化：单个时间点或时间区间自动识别
  - 亲代节点视觉标识：半透明绿色背景和边框
  - 编辑器提供下拉选择框，方便选择亲代节点

- **📦 包管理器增强**：
  - 新增右键菜单创建 `.tjson5` 时间线文件功能
  - 自动生成时间线文件模板

- **📋 启动快照优化**：
  - 新增"不再提示"按钮，可永久关闭启动快照通知
  - 配置持久化到用户全局设置

- **🗂️ 角色引用关系支持**：
  - 支持通过`AndreaNovelHelper.roleUsage.rebuildIndex`建立/重建角色引用关系索引
  - 支持在右键角色时查看引用该角色的所有位置

---

### [0.4.5] - 2025-10-01

#### 🖋️ 更改
- 支持SQLite后端作为数据库存储选项，提升大型项目的性能和响应速度
- 优化了文件追踪器的初始化流程，减少启动时间

#### ✨ 新增
- 新增启动快照（快速启动）支持 即使使用Json数据库 依然可以快速启动
- 新增可以拖到侧栏的批注面板

---

### [0.4.4] - 2025-09-28

#### 🐛 修复
- 修复角色关系图中节点文本与数据不一致的问题：确保在所有节点更新操作中，`node.text` 和 `node.data.text` 始终保持同步，避免因不一致导致的显示和逻辑错误。
- 修复增量更新角色文件时未正确更新关系图的问题：确保在增量加载角色文件时，相关的关系图节点和边也能正确反映最新的角色数据。
- 修复了关系图数据更新不刷新角色数据的问题：确保在关系图数据更新后，相关的角色数据也能同步刷新，保持一致性。

---

### [0.4.3] - 2025-09-28

#### ✨ 新增
- **🔗 角色关系图编辑器**：全新的可视化角色关系管理系统
  - 支持拖拽式关系图编辑和实时预览
  - 右键菜单操作：添加连线、删除连线、编辑节点
  - 节点过滤和筛选功能，支持按类型、名称等条件过滤
  - Hover悬停显示角色详细信息
  - 支持角色绑定和关系类型定义

- **📄 新增文件格式支持**：
  - 新增 `.rjson5`（关系文件）和 `.ojson5`（对象文件）格式支持
  - 包管理器中正确显示和管理这些文件类型
  - 自动文件监控和加载机制

- **🎯 角色管理增强**：
  - 新增角色UUID系统，支持前端和后端唯一标识
  - 支持跳转到定义功能，快速定位角色相关内容
  - 关系文件解析器和自动加载功能

#### 🖋️ 更改
- **🔧 系统优化**：
  - 重构文件变更追踪依赖系统，提升性能和稳定性
  - 智能窗体锁定功能，改善用户体验
  - AutoGit 自动拉取功能，保持代码同步
  - 优化状态栏指示器：为所有状态栏添加ID和名字，便于管理
  - WebDAV同步机制优化：使用额外meta文件提升同步效率

#### 🐛 修复
- 修复包管理器中 `.rjson5` 和 `.ojson5` 文件显示问题
- 修复文件监控系统中的角色数据更新逻辑
- 改进关系图编辑器的稳定性和用户交互体验

---

### [0.4.2] - 2025-09-15

#### 🖋️ 更改
- 降低 VS Code 引擎要求到 ^1.100.0，以支持 Trae 安装与运行

---

### [0.4.1] - 2025-09-15

#### 🐛 修复
- 修复WebDAV面板diff列表中混入目录类型的问题：在文件比较时过滤掉目录类型，确保只显示文件差异
- 修复WebDAV面板中远程文件统计数量不准确的问题：统计信息现在正确反映过滤后的文件数量

#### ✨ 新增
- 新增独立的批注功能侧边栏（AndreaCommentsSidebar）：将批注管理功能从主侧边栏中分离，提供更专注的批注管理体验
- 新增独立的WebDAV功能侧边栏（AndreaWebDAVSidebar）：将WebDAV相关功能从主侧边栏中分离，包括WebDAV管理面板和文件树视图

#### 🖋️ 更改
- 重新组织侧边栏结构：原小说助手侧边栏现在专注于核心功能（包管理器、角色管理），批注和WebDAV功能移至各自的专用侧边栏
- 优化用户界面布局：通过功能分离提供更清晰的工作流程和更好的用户体验

---

### [0.4.0] - 2025-09-15

#### ✨ 新增
- 新增WebDAV云端同步功能：支持与WebDAV服务器进行文件同步，实现跨设备协作
- 新增WebDAV同步状态栏：实时显示同步状态，支持转圈动画和进度显示
- 新增WebDAV账户管理：支持多账户配置和管理
- 新增WebDAV文件树视图：可视化管理云端文件
- 新增WebDAV同步面板：提供详细的同步配置和状态信息
- 新增错别字统计功能：智能识别和统计文档中的错别字，提供详细的错误分析和修正建议
- 新增批注功能：支持在文档中添加、编辑和管理批注，便于写作过程中的备注和协作交流
- 新增批注管理器：提供批注的归总，转跳，便于快速处理伏笔等要点。

#### 🖋️ 更改
- 改进状态栏显示：提供更详细的状态信息和用户反馈

---

## 更多版本日志

更多历史版本的更新日志请参考项目的 [CHANGELOG.md](https://github.com/andrea-novel-helper/andrea-novel-helper/blob/main/CHANGELOG.md)。
